# 謎解きイベント収集・共有アプリ「NazoNote」要件定義書

## 1. プロジェクト概要

### コンセプト

**「次の週末、どこ行く？」をURLひとつで解決する。**
友人グループ専用の、ポップで賢い謎解きイベントストックアプリ。

### 目的 (Why)

- Web上に散らばる謎解きイベント情報を、URLをコピペするだけで手軽に集約・データベース化する。
- 「いつ終わるか」を可視化し、駆け込み参加や予定の調整をスムーズにする。
- 誰かが「気になる」と思ったイベントをお気に入りに登録し、グループ全体の「遊び候補リスト」を作成する。

### サービス名案

1. **NazoNote (ナゾノート)**: 謎を書き留めるノート。響きがポップ。
2. **TokiDoki (トキドキ)**: 解く時のドキドキ感 ＋ 時々行くイベント。
3. **PuzzLog (パズログ)**: Puzzle + Log。シンプル。

## 2. ユーザー体験 (UX) & デザイン方針

### トーン＆マナー

- **キーワード:** ポップ、優しい、ワクワク、角丸 (Rounded)、パステル、ハート
- **配色テーマ:**
    - ベース: クリーム色 (`#FFFBF0`)
    - メイン: パステルオレンジ (`#FFB347`) - 「楽しさ」
    - アクセント: ミントグリーン (`#98FF98`) - 「開催中/Go」
    - アラート: ソフトコーラル (`#F08080`) - 「もうすぐ終了」
- **UIの特徴:**
    - `border-radius` は大きめ (XL以上) で、柔らかい印象に。
    - 文字は少し太めのゴシック体（M PLUS Rounded 1c など推奨）。
    - 業務ツール感を消すため、表形式（Table）ではなくカード形式（Grid）を基本とする。

### コア体験： 「終了期限」の可視化

- **「焦らせないアラート」:**
    - 終了間近でも赤字で警告するのではなく、「あと3日でフィナーレ！」「今週末までだよ」といった、キャラクターが教えてくれるような優しい表現を採用。

## 3. 機能要件 (MVP)

### A. URLイベント登録機能（最重要・Killer Feature）

ユーザーのアクションを極限まで減らすための自動化機能。

1. **入力:** ユーザーが「イベント追加」ボタンを押し、公式サイトのURLをペースト。
2. **処理:**
    - システムがHTMLを取得 (Scraping)。
    - LLM (OpenAI/Gemini) がHTMLを解析し、以下のJSONを抽出。
        - `title` (タイトル)
        - `start_date`, `end_date` (開催期間)
        - `location` (開催場所/エリア)
        - `price` (価格)
        - `maker` (製作者/団体)
        - `duration` (所要時間目安)
        - `image_url` (メインビジュアル)
        - `summary` (ストーリー概要)
3. **確認:** 抽出されたデータがフォームに入力された状態でモーダルが開く。
4. **保存:** ユーザーが必要に応じて修正し、「登録」ボタンでDB保存。

### B. 一覧・検索機能

- **スマートソート:**
    - デフォルト: **「終了日が近い順（開催中のみ）」**
    - 切り替え: 「新着順」「開催場所順」「お気に入りが多い順」
- **ステータスバッジ:**
    - `🟢 開催中`
    - `🟠 あと○日で終了` (終了日まで14日以内の場合)
    - `🔵 開催予定` (開始日前)
    - `⚪️ 終了`
- **絞り込み:**
    - エリア（東京、神奈川、関西など）
    - タイプ（周遊型、屋内型）
    - **お気に入り登録済みのみ表示**（グループの候補リストとして機能）

### C. ユーザーアクション（共有・記録）

- **お気に入り (Favorite):**
    - **機能:** 「これ気になる！」「候補に入れよう」という意思表示。
    - **挙動:** 誰でもワンタップで登録可能。自分と友人の区別なく、グループ内で「誰かが気になっているイベント」として扱われる。
    - **UI:** カード上のハートマーク♡をタップして登録。
- **行った (Log):**
    - 「クリア」「失敗」のステータス記録。
    - 5段階の星評価。
    - 一言メモ（「歩きやすい靴推奨」「ランチは○○がおすすめ」など内輪向け情報）。

## 4. アプリケーションフロー & アーキテクチャ

### データフロー (URL登録時)

```
sequenceDiagram
    participant User
    participant Frontend (Next.js)
    participant EdgeFunc (Supabase/Vercel)
    participant LLM (Gemini/OpenAI)
    participant DB (Supabase)

    User->>Frontend: URLをペースト
    Frontend->>EdgeFunc: URLを送信
    EdgeFunc->>EdgeFunc: HTML fetch & テキスト抽出
    EdgeFunc->>LLM: テキスト解析 & JSON抽出指示
    LLM-->>EdgeFunc: JSONデータ返却
    EdgeFunc-->>Frontend: フォーム初期値として返却
    User->>Frontend: 内容確認・修正
    Frontend->>DB: イベントデータ保存

```

### 技術スタック

- **Frontend:** Next.js (App Router), React
- **Styling:** Tailwind CSS, Shadcn/UI (スタイルカスタマイズ), Lucide React (アイコン)
- **Backend:** Supabase (PostgreSQL, Auth, Edge Functions)
- **AI:** Vercel AI SDK ( `generateObject` メソッド推奨) + Gemini 1.5 Flash (安価で高速なため推奨)

## 5. データモデル設計 (Schema)

### `events` テーブル

イベントの基本情報（グループ共有マスタデータ）

| **Column** | **Type** | **Description** |
| `id` | uuid | PK |
| `title` | text | イベント名 |
| `url` | text | 公式サイトURL |
| `image_url` | text | サムネイル画像URL |
| `start_date` | date | 開始日 |
| `end_date` | date | 終了日 (NULL可：常設の場合) |
| `location` | text | 場所・集合場所 |
| `area` | text | 都道府県・主要エリア（タグ用） |
| `type` | text | 周遊/ホール/ルーム/オンライン |
| `maker` | text | 制作団体（SCRAPなど） |
| `price` | text | 価格情報（テキストで柔軟に） |
| `description` | text | ストーリー・概要 |
| `created_by` | uuid | 登録したユーザーID |
| `created_at` | timestamp |  |

### `user_event_logs` テーブル

各ユーザーのステータス管理（お気に入り/行った）

| **Column** | **Type** | **Description** |
| `id` | uuid | PK |
| `user_id` | uuid | FK (Users) |
| `event_id` | uuid | FK (Events) |
| `status` | text | 'FAVORITE' (お気に入り/候補), 'WENT' (行った) |
| `result` | text | 'CLEAR', 'FAIL', NULL |
| `rating` | integer | 1-5 (行った場合のみ) |
| `memo` | text | 内輪向けコメント |
| `updated_at` | timestamp |  |

## 6. 画面構成案 (Wireframe Idea)

### A. イベント一覧画面 (Home)

- **ヘッダー:** アプリロゴと、目立つ「＋ URLから追加」ボタン。
- **フィルターバー:** 横スクロール可能なチップ形式（$$すべて$$$$お気に入り❤️$$$$開催中$$$$東京$$
    
    ...）。
    
- **カードデザイン:**
    - **画像:** アスペクト比 16:9。角丸。
    - **残り期間バッジ:** 画像の右上に「あと5日！」と吹き出し風に配置。
    - **お気に入りボタン:** カード右下（または画像上）に配置されたハートアイコン。
        - 未登録：白抜きのハート ♡
        - 登録済：ピンクまたはオレンジのハート ♥（アニメーション付き）
        - ※自分または友人が登録していれば、誰でも視認可能にする。
    - **情報:** タイトル（太字）、場所（アイコン付き）、開催期間。
    - **アクションバー:** カード下部に「行った🚩」ボタン（ログ登録用）。

### B. 詳細・登録モーダル

- URL解析後の確認画面を兼ねる。
- 自動入力された項目が並ぶ。
- 「保存する」ボタンを押すと、紙吹雪のエフェクト（Confetti）が出て登録完了を祝う（ポップさの演出）。

## 7. 実装ステップ (MVP Road Map)

1. **Phase 1: 土台とデータ**
    - Next.js + Supabase プロジェクト作成。
    - DBテーブル作成。
    - 手動でのイベント登録・表示機能。
2. **Phase 2: AI自動入力 (Core)**
    - Edge Function作成。
    - URLから情報を引っこ抜く処理の実装。
3. **Phase 3: UI/UX磨き込み**
    - **お気に入り機能（ハートボタン）の実装と、お気に入り一覧フィルターの実装。**
    - 「開催中/終了間近」の自動判定ロジック実装。
    - ポップなデザインの適用。